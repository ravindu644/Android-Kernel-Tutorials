commit fc01aefa53c353dff834fff0cccefcfccbd80414
Author: ravindu644 <droidcasts@protonmail.com>
Date:   Sat Nov 29 12:37:37 2025 +0530

    selinux: Add togglable selinux boot status
    
    Signed-off-by: Ravindu Deshan <droidcasts@protonmail.com>

diff --git a/security/selinux/Kconfig b/security/selinux/Kconfig
index 8297e48a2..4b90de969 100755
--- a/security/selinux/Kconfig
+++ b/security/selinux/Kconfig
@@ -71,6 +71,20 @@ config SECURITY_SELINUX_DEVELOP
      can interactively toggle the kernel between enforcing mode and
      permissive mode (if permitted by the policy) via /selinux/enforce.
 
+config SECURITY_SELINUX_ALWAYS_ENFORCE
+   bool "NSA SELinux Always Enforcing"
+   depends on SECURITY_SELINUX_DEVELOP
+   default y
+   help
+       This option will prevent anything from setting SELinux to permissive.
+
+config SECURITY_SELINUX_ALWAYS_PERMISSIVE
+   bool "NSA SELinux Always Permissive"
+   depends on SECURITY_SELINUX_DEVELOP
+   default n
+   help
+       This option will prevent anything from setting SELinux to enforcing.
+
 config SECURITY_SELINUX_AVC_STATS
    bool "NSA SELinux AVC Statistics"
    depends on SECURITY_SELINUX
diff --git a/security/selinux/hooks.c b/security/selinux/hooks.c
index 0d78337ea..1ce081f81 100755
--- a/security/selinux/hooks.c
+++ b/security/selinux/hooks.c
@@ -112,8 +112,13 @@ static int __init enforcing_setup(char *str)
 {
    unsigned long enforcing;
    if (!kstrtoul(str, 0, &enforcing))
+#ifdef CONFIG_SECURITY_SELINUX_ALWAYS_ENFORCE
        selinux_enforcing_boot = enforcing ? 1 : 0;
    return 1;
+#elif defined(CONFIG_SECURITY_SELINUX_ALWAYS_PERMISSIVE)
+       selinux_enforcing_boot = 0;
+   return 0;
+#endif
 }
 __setup("enforcing=", enforcing_setup);
 #else
diff --git a/security/selinux/selinuxfs.c b/security/selinux/selinuxfs.c
index f6bc78aba..1431c7849 100755
--- a/security/selinux/selinuxfs.c
+++ b/security/selinux/selinuxfs.c
@@ -159,6 +159,12 @@ static ssize_t sel_write_enforce(struct file *file, const char __user *buf,
 
    new_value = !!new_value;
 
+#ifdef CONFIG_SECURITY_SELINUX_ALWAYS_ENFORCE
+   new_value = 1;
+#elif defined(CONFIG_SECURITY_SELINUX_ALWAYS_PERMISSIVE)
+   new_value = 0;
+#endif
+
    old_value = enforcing_enabled(state);
    if (new_value != old_value) {
        length = avc_has_perm(&selinux_state,
